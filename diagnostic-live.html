<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diagnostic Live - Boutons de Fermeture</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        .diagnostic-panel {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .test-section {
            border: 2px solid #ddd;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            position: relative;
        }
        .test-section.active {
            border-color: #007bff;
            background: #f8f9fa;
        }
        .close-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            cursor: pointer;
            font-size: 16px;
        }
        .log {
            background: #f8f9fa;
            border: 1px solid #ddd;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
        }
        .btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .error { color: #dc3545; }
        .success { color: #28a745; }
        .warning { color: #ffc107; }
    </style>
</head>
<body>
    <div class="diagnostic-panel">
        <h1>üîç Diagnostic Live - Boutons de Fermeture</h1>
        
        <div class="controls">
            <button class="btn" onclick="runDiagnostic()">üîÑ Lancer Diagnostic</button>
            <button class="btn" onclick="clearLog()">üóëÔ∏è Vider Log</button>
            <button class="btn" onclick="testOnMainSite()">üåê Tester sur Site Principal</button>
        </div>
        
        <div class="log" id="diagnosticLog"></div>
    </div>

    <div class="test-section active" id="testSection1">
        <button class="close-btn" data-close-section onclick="closeSection(this)">√ó</button>
        <h3>Section Test 1</h3>
        <p>Cette section devrait se fermer quand on clique sur le bouton √ó</p>
    </div>

    <div class="test-section" id="testSection2">
        <button class="close-btn" data-close-section onclick="closeSection(this)">√ó</button>
        <h3>Section Test 2</h3>
        <p>Cette section devrait aussi se fermer</p>
    </div>

    <script>
        let logElement = document.getElementById('diagnosticLog');
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const className = type === 'error' ? 'error' : type === 'success' ? 'success' : type === 'warning' ? 'warning' : '';
            logElement.innerHTML += `<div class="${className}">[${timestamp}] ${message}</div>`;
            logElement.scrollTop = logElement.scrollHeight;
        }
        
        function clearLog() {
            logElement.innerHTML = '';
        }
        
        function closeSection(button) {
            log('üî¥ closeSection appel√©e directement', 'success');
            const section = button.closest('.test-section');
            if (section) {
                section.style.display = 'none';
                log('‚úÖ Section ferm√©e avec succ√®s', 'success');
            } else {
                log('‚ùå Section parente non trouv√©e', 'error');
            }
        }
        
        function runDiagnostic() {
            log('üöÄ D√©but du diagnostic...', 'info');
            
            // Test 1: V√©rifier la pr√©sence des boutons
            const closeButtons = document.querySelectorAll('[data-close-section]');
            log(`üìä Nombre de boutons [data-close-section] trouv√©s: ${closeButtons.length}`, closeButtons.length > 0 ? 'success' : 'error');
            
            // Test 2: V√©rifier les √©couteurs d'√©v√©nements
            closeButtons.forEach((btn, index) => {
                log(`üîç Bouton ${index + 1}: ${btn.tagName} avec classes: ${btn.className}`, 'info');
                
                // Tester le clic programmatique
                try {
                    btn.click();
                    log(`‚úÖ Clic programmatique sur bouton ${index + 1} r√©ussi`, 'success');
                } catch (e) {
                    log(`‚ùå Erreur lors du clic sur bouton ${index + 1}: ${e.message}`, 'error');
                }
            });
            
            // Test 3: V√©rifier les sections parentes
            const sections = document.querySelectorAll('.test-section');
            log(`üìä Nombre de sections test trouv√©es: ${sections.length}`, 'info');
            
            sections.forEach((section, index) => {
                const isVisible = section.style.display !== 'none';
                log(`üìã Section ${index + 1} visible: ${isVisible}`, isVisible ? 'success' : 'warning');
            });
        }
        
        function testOnMainSite() {
            log('üåê Test sur le site principal...', 'info');
            
            // Ouvrir le site principal dans une nouvelle fen√™tre avec du code de test
            const testCode = `
                // Code de diagnostic √† ex√©cuter sur le site principal
                console.log('üîç Diagnostic des boutons de fermeture');
                
                const closeButtons = document.querySelectorAll('[data-close-section]');
                console.log('Boutons trouv√©s:', closeButtons.length);
                
                closeButtons.forEach((btn, i) => {
                    console.log('Bouton', i, ':', btn);
                    console.log('Parent section:', btn.closest('.feature-section'));
                });
                
                // Tester un clic
                if (closeButtons.length > 0) {
                    console.log('Test de clic sur le premier bouton...');
                    closeButtons[0].click();
                }
            `;
            
            log('üìã Code de test copi√© dans le presse-papiers. Collez-le dans la console du site principal.', 'info');
            navigator.clipboard.writeText(testCode).then(() => {
                log('‚úÖ Code copi√© avec succ√®s!', 'success');
            }).catch(() => {
                log('‚ùå Impossible de copier le code', 'error');
            });
            
            // Ouvrir le site principal
            window.open('https://liilvame.github.io/HTMLtoPNG/', '_blank');
        }
        
        // Initialisation
        document.addEventListener('DOMContentLoaded', () => {
            log('üéØ Diagnostic Live initialis√©', 'success');
            runDiagnostic();
        });
        
        // √âcouteur global pour capturer tous les clics
        document.addEventListener('click', (e) => {
            if (e.target.hasAttribute('data-close-section')) {
                log(`üéØ Clic d√©tect√© sur bouton avec data-close-section: ${e.target.tagName}`, 'info');
            }
        }, true);
    </script>
</body>
</html>