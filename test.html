<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test HTML to PNG</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        textarea { width: 100%; height: 200px; margin: 10px 0; }
        button { padding: 10px 20px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; }
        button:hover { background: #0056b3; }
        #preview { border: 1px solid #ccc; margin: 10px 0; min-height: 200px; padding: 10px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Test HTML to PNG Converter</h1>
        
        <div>
            <label for="htmlInput">Code HTML:</label>
            <textarea id="htmlInput" placeholder="Entrez votre code HTML ici..."><h1>Hello World!</h1><p>Ceci est un test.</p></textarea>
        </div>
        
        <div>
            <label for="cssInput">Code CSS:</label>
            <textarea id="cssInput" placeholder="Entrez votre code CSS ici...">h1 { color: blue; } p { color: green; }</textarea>
        </div>
        
        <div>
            <button onclick="updatePreview()">Mettre à jour l'aperçu</button>
            <button onclick="downloadPNG()">Télécharger PNG</button>
        </div>
        
        <div>
            <h3>Aperçu:</h3>
            <div id="preview"></div>
        </div>
    </div>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script>
        function updatePreview() {
            const htmlInput = document.getElementById('htmlInput');
            const cssInput = document.getElementById('cssInput');
            const preview = document.getElementById('preview');
            
            const htmlContent = htmlInput.value;
            const cssContent = cssInput.value;
            
            // Create complete HTML with CSS
            const fullHTML = `
                <style>${cssContent}</style>
                ${htmlContent}
            `;
            
            preview.innerHTML = fullHTML;
            console.log('Aperçu mis à jour avec succès');
        }
        
        async function downloadPNG() {
            const preview = document.getElementById('preview');
            
            if (!preview.innerHTML.trim()) {
                alert('Veuillez d\'abord mettre à jour l\'aperçu');
                return;
            }
            
            try {
                console.log('Début de la conversion PNG...');
                const canvas = await html2canvas(preview, {
                    backgroundColor: '#ffffff',
                    scale: 2,
                    useCORS: true
                });
                
                // Create download link
                const link = document.createElement('a');
                link.download = 'converted-image.png';
                link.href = canvas.toDataURL('image/png');
                link.click();
                
                console.log('Conversion PNG réussie!');
            } catch (error) {
                console.error('Erreur lors de la conversion:', error);
                alert('Erreur lors de la conversion: ' + error.message);
            }
        }
        
        // Initialize preview on load
        document.addEventListener('DOMContentLoaded', () => {
            console.log('Page de test chargée avec succès');
            updatePreview();
        });
    </script>
</body>
</html>